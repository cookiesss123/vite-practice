import{M as y}from"./modal-4b4bab9a.js";import{_ as f,o as c,c as u,b as t,g as p,v as r,j as $,i as h,r as k,F as w,h as M,d as T,t as i,n as V}from"./index-01685dd6.js";const{VITE_URL:m,VITE_PATH:_}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"cookiesss",BASE_URL:"/vite-practice/",MODE:"production",DEV:!1,PROD:!0},x={props:["getCoupons","id","coupons","openModal"],data(){return{myModal:{},tempCoupon:{},due_date:""}},methods:{show(){this.myModal.show()},hide(){this.myModal.hide()},addCoupon(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)cookiesssToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=e,this.due_date=new Date(this.due_date).getTime()/1e3,this.tempCoupon.due_date=this.due_date,this.$http.post(`${m}/api/${_}/admin/coupon`,{data:this.tempCoupon}).then(o=>{this.getCoupons(),this.$swal({icon:"success",title:o.data.message,showConfirmButton:!1,timer:1e3}),this.hide()}).catch(o=>{console.log(o.response.data.message)})},updateCoupon(){this.$http.put(`${m}/api/${_}/admin/coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then(e=>{this.getCoupons(),this.$swal({icon:"success",title:e.data.message,showConfirmButton:!1,timer:1e3}),this.hide()}).catch(e=>{console.log(e.response.data.message)})}},watch:{id(){if(console.log("id 改變了"),this.id!=="new"&&this.id!==""){this.tempCoupon=this.coupons.filter(o=>o.id===this.id),this.tempCoupon={...this.tempCoupon[0]};const e=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");this.due_date=e[0],console.log(this.tempCoupon),this.show(),this.openModal("")}}},mounted(){this.myModal=new y(this.$refs.couponModal)}},E={class:"modal fade",ref:"couponModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},I={class:"modal-dialog"},D={class:"modal-content"},U=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"新增優惠券"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),A={class:"modal-body"},L={class:"row gy-3"},R={class:"col-12"},B=t("label",{for:"title",class:"form-label mb-0"},"標題",-1),P={class:"col-12"},H=t("label",{for:"code",class:"form-label mb-0"},"優惠碼",-1),O={class:"col-12"},S=t("label",{for:"due_date",class:"form-label mb-0"},"到期日",-1),z={class:"col-12"},F=t("label",{for:"percent",class:"form-label mb-0"},"折扣百分比",-1),N={class:"col-12"},j={class:"form-check"},Y=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),q={class:"modal-footer"},G=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function J(e,o,a,g,n,d){return c(),u("div",E,[t("div",I,[t("div",D,[U,t("div",A,[t("div",L,[t("div",R,[B,p(t("input",{type:"text",id:"title",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=s=>n.tempCoupon.title=s)},null,512),[[r,n.tempCoupon.title]])]),t("div",P,[H,p(t("input",{type:"text",id:"code",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[1]||(o[1]=s=>n.tempCoupon.code=s)},null,512),[[r,n.tempCoupon.code]])]),t("div",O,[S,p(t("input",{type:"date",id:"due_date",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>n.due_date=s)},null,512),[[r,n.due_date]])]),t("div",z,[F,p(t("input",{type:"number",id:"percent",class:"form-control",placeholder:"請輸入折扣百分比","onUpdate:modelValue":o[3]||(o[3]=s=>n.tempCoupon.percent=s)},null,512),[[r,n.tempCoupon.percent]])]),t("div",N,[t("div",j,[p(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=s=>n.tempCoupon.is_enabled=s)},null,512),[[$,n.tempCoupon.is_enabled]]),Y])])])]),t("div",q,[G,a.id==="new"?(c(),u("button",{key:0,type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=(...s)=>d.addCoupon&&d.addCoupon(...s))},"新增優惠券")):h("",!0),a.id!=="new"?(c(),u("button",{key:1,type:"button",class:"btn btn-primary",onClick:o[6]||(o[6]=(...s)=>d.updateCoupon&&d.updateCoupon(...s))},"編輯優惠券")):h("",!0)])])])],512)}const K=f(x,[["render",J]]),{VITE_URL:b,VITE_PATH:C}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"cookiesss",BASE_URL:"/vite-practice/",MODE:"production",DEV:!1,PROD:!0},Q={components:{CouponModal:K},data(){return{coupons:[],couponId:""}},methods:{getCoupons(){const e=this.$loading.show(),o=document.cookie.replace(/(?:(?:^|.*;\s*)cookiesssToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=o,this.$http.get(`${b}/api/${C}/admin/coupons`).then(a=>{console.log(a.data.coupons),this.coupons=a.data.coupons,e.hide()}).catch(a=>{console.log(a.response.data.message)})},openModal(e){this.couponId=e,this.couponId==="new"&&this.$refs.modal.show()},deleteCoupon(e){this.$http.delete(`${b}/api/${C}/admin/coupon/${e}`).then(o=>{this.getCoupons(),this.$swal({icon:"success",title:o.data.message,showConfirmButton:!1,timer:1e3}),this.$refs.modal.hide(),console.log(o)}).catch(o=>{console.log(o)})}},mounted(){this.getCoupons()}},W=t("h1",null,"優惠券",-1),X={class:"d-flex"},Z={class:"table"},tt=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),ot={class:"btn-group"},et=["onClick"],st=["onClick"];function nt(e,o,a,g,n,d){const s=k("CouponModal");return c(),u("div",null,[W,t("div",X,[t("button",{type:"button",class:"btn btn-primary ms-auto mx-5",onClick:o[0]||(o[0]=l=>d.openModal("new"))},"建立新的優惠券")]),t("table",Z,[tt,t("tbody",null,[(c(!0),u(w,null,M(n.coupons,l=>(c(),u("tr",{key:l.id},[t("td",null,i(l.title),1),t("td",null,i(l.percent)+" %",1),t("td",null,i(new Date(l.due_date*1e3).getFullYear())+"/"+i(new Date(l.due_date*1e3).getMonth()+1)+"/"+i(new Date(l.due_date*1e3).getDate()),1),t("td",{class:V({"text-success":l.is_enabled,"fw-bold":l.is_enabled})},i(`${l.is_enabled?"啟用":"未啟用"}`),3),t("td",null,[t("div",ot,[t("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:v=>d.openModal(l.id)},"編輯",8,et),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:v=>d.deleteCoupon(l.id)},"刪除",8,st)])])]))),128))])]),T(s,{ref:"modal","get-coupons":d.getCoupons,id:n.couponId,coupons:n.coupons,"open-modal":d.openModal},null,8,["get-coupons","id","coupons","open-modal"])])}const at=f(Q,[["render",nt]]);export{at as default};
