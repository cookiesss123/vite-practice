import{_ as U,a as B,r as f,o as i,c as r,b as t,F as v,h as C,t as n,i as y,g as V,v as $,d,w as x,p as q,f as k,q as T,n as b}from"./index-878bfeda.js";const{VITE_URL:u,VITE_PATH:m}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"cookiesss",BASE_URL:"/vite-practice/",MODE:"production",DEV:!1,PROD:!0},I={components:{RouterLink:B},data(){return{cart:{},products:[],code:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"需要正確的電話號碼"},getCarts(){this.$http.get(`${u}/api/${m}/cart`).then(e=>{console.log(e.data.data),this.cart=e.data.data}).catch(e=>{console.log(e.response.data.message)})},getProducts(){this.$http.get(`${u}/api/${m}/products/all`).then(e=>{console.log(e.data.products),this.products=e.data.products}).catch(e=>{console.log(e.response.data.message)})},addCart(e,s=1){const h={product_id:e,qty:s};this.$http.post(`${u}/api/${m}/cart`,{data:h}).then(p=>{this.$swal({icon:"success",title:p.data.message,showConfirmButton:!1,timer:1e3}),this.getCarts()}).catch(p=>{console.log(p.response.data.message)})},deleteCart(e){this.$http.delete(`${u}/api/${m}/cart/${e}`).then(s=>{this.$swal({icon:"success",title:s.data.message,showConfirmButton:!1,timer:1e3}),this.getCarts()}).catch(s=>{console.log(s.response.data.message)})},deleteAll(){this.$http.delete(`${u}/api/${m}/carts`).then(e=>{this.$swal({icon:"success",title:e.data.message,showConfirmButton:!1,timer:1e3}),this.getCarts()}).catch(e=>{console.log(e.response.data.message)})},useCoupon(){const e={code:this.code};this.$http.post(`${u}/api/${m}/coupon`,{data:e}).then(s=>{console.log(s.data),this.getCarts(),this.$swal({icon:"success",title:s.data.message,showConfirmButton:!1,timer:1e3})}).catch(s=>{console.log(s.response.data.message),this.$swal({icon:"error",title:s.response.data.message,showConfirmButton:!1,timer:1e3})})},updateCartItem(e){const s={product_id:e.product.id,qty:e.qty};this.$http.put(`${u}/api/${m}/cart/${e.id}`,{data:s}).then(h=>{this.$swal({icon:"success",title:h.data.message,showConfirmButton:!1,timer:1e3}),this.getCarts()}).catch(h=>{console.log(h.response.data.message)})},createOrder(){this.$http.post(`${u}/api/${m}/order`,{data:this.form}).then(e=>{this.$swal({icon:"success",title:e.data.message,showConfirmButton:!1,timer:1e3}),this.$router.push(`/checkout/${e.data.orderId}`)}).catch(e=>{console.log(e.response.data.message)})}},mounted(){this.getCarts(),this.getProducts()}},L={class:"container d-flex flex-column"},P=t("h1",null,"購物車",-1),R={class:"table",style:{"vertical-align":"middle"}},A=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th",null,"功能")])],-1),F={style:{width:"200px"}},N={class:"btn-group"},S=["onClick"],D={class:"d-flex"},M={class:"table",style:{"vertical-align":"middle"}},O=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",null,"數量"),t("th",null,"單價")])],-1),z=["onClick"],H=t("i",{class:"bi bi-x"},null,-1),j=[H],G={class:"mb-0"},J={key:0,class:"mb-0 text-success"},K={style:{width:"150px"}},Q={class:"input-group mb-3"},W=["onUpdate:modelValue","onChange"],X=["value"],Y={class:"input-group-text",id:"basic-addon2"},Z={class:"text-end"},tt={key:0},et=t("span",{class:"text-success"},"折扣價：",-1),st=t("td",null,null,-1),ot=t("td",null,null,-1),lt=t("td",{class:"text-end"},"總計",-1),at={class:"text-end"},nt={key:0},dt=t("td",null,null,-1),ct=t("td",null,null,-1),it=t("td",{class:"text-end"},"折扣價：",-1),rt={class:"text-end text-success"},ut={class:"input-group mb-3"},mt={class:"mb-3"},ht=t("label",{for:"email",class:"form-label"},"Email",-1),pt={class:"mb-3"},_t=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),gt={class:"mb-3"},ft=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),bt={class:"mb-3"},vt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Ct={class:"mb-3"},yt=t("label",{for:"message",class:"form-label"},"留言",-1),Vt=t("div",{class:"text-end"},[t("button",{class:"btn btn-danger"},"送出訂單")],-1);function xt(e,s,h,p,l,c){const w=f("RouterLink"),_=f("VField"),g=f("ErrorMessage"),E=f("VForm");return i(),r("div",L,[P,t("table",R,[A,t("tbody",null,[(i(!0),r(v,null,C(l.products,o=>(i(),r("tr",{key:o.id},[t("td",F,[t("div",{style:q([{"background-image":`url(${o.imageUrl})`},{height:"100px","background-position":"center","background-size":"cover"}])},null,4)]),t("td",null,[d(w,{to:"/login"},{default:x(()=>[k(n(o.title),1)]),_:2},1024)]),t("td",null,[t("del",null," 原價 "+n(o.origin_price)+" 元 ",1),t("h5",null,"現在只要 "+n(o.price)+" 元",1)]),t("td",null,[t("div",N,[d(w,{to:`/product/${o.id}`,class:"btn btn-sm btn-outline-secondary"},{default:x(()=>[k("查看更多")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:a=>c.addCart(o.id)},"加到購物車",8,S)])])]))),128))])]),t("div",D,[t("button",{type:"button",class:"btn btn-outline-danger ms-auto",onClick:s[0]||(s[0]=(...o)=>c.deleteAll&&c.deleteAll(...o))},"清空購物車")]),t("table",M,[O,t("tbody",null,[(i(!0),r(v,null,C(l.cart.carts,o=>(i(),r("tr",{key:o.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger ms-auto py-1 px-2",onClick:a=>c.deleteCart(o.id)},j,8,z)]),t("td",null,[t("p",G,n(o.product.title),1),o.coupon?(i(),r("p",J,"已套用優惠券【"+n(o.coupon.title)+"】",1)):y("",!0)]),t("td",K,[t("div",Q,[V(t("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":a=>o.qty=a,onChange:a=>c.updateCartItem(o)},[(i(),r(v,null,C(20,a=>t("option",{key:a+3453534,value:a},n(a),9,X)),64))],40,W),[[T,o.qty]]),t("span",Y,"/"+n(o.product.unit),1)])]),t("td",Z,[t("p",null,"原價："+n(o.total),1),o.coupon?(i(),r("p",tt,[et,k(n(o.final_total),1)])):y("",!0)])]))),128)),t("tr",null,[st,ot,lt,t("td",at,n(l.cart.total),1)]),l.cart.final_total!==l.cart.total?(i(),r("tr",nt,[dt,ct,it,t("td",rt,n(l.cart.final_total),1)])):y("",!0)])]),t("div",ut,[V(t("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":s[1]||(s[1]=o=>l.code=o)},null,512),[[$,l.code]]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[2]||(s[2]=(...o)=>c.useCoupon&&c.useCoupon(...o))},"套用優惠碼")]),d(E,{ref:"form",class:"col-md-6 align-self-center",onSubmit:c.createOrder},{default:x(({errors:o})=>[t("div",mt,[ht,d(_,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[3]||(s[3]=a=>l.form.user.email=a)},null,8,["class","modelValue"]),d(g,{name:"email",class:"invalid-feedback"})]),t("div",pt,[_t,d(_,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[4]||(s[4]=a=>l.form.user.name=a)},null,8,["class","modelValue"]),d(g,{name:"姓名",class:"invalid-feedback"})]),t("div",gt,[ft,d(_,{id:"tel",name:"電話",type:"tel",class:b(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:c.isPhone,modelValue:l.form.user.tel,"onUpdate:modelValue":s[5]||(s[5]=a=>l.form.user.tel=a)},null,8,["class","rules","modelValue"]),d(g,{name:"電話",class:"invalid-feedback"})]),t("div",bt,[vt,d(_,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[6]||(s[6]=a=>l.form.user.address=a)},null,8,["class","modelValue"]),d(g,{name:"地址",class:"invalid-feedback"})]),t("div",Ct,[yt,V(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[7]||(s[7]=a=>l.form.message=a)},null,512),[[$,l.form.message]])]),Vt]),_:1},8,["onSubmit"])])}const wt=U(I,[["render",xt]]);export{wt as default};
